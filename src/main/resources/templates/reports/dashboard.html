<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Reports - POS System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">POS System</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/products">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/sales">Sales</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/reports">Reports</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Period Selection -->
        <div class="card mb-4">
            <div class="card-body">
                <form th:action="@{/reports}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <select name="period" class="form-select" onchange="this.form.submit()">
                            <option value="month" th:selected="${selectedPeriod == 'month'}">This Month</option>
                            <option value="year" th:selected="${selectedPeriod == 'year'}">This Year</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select name="year" class="form-select" onchange="this.form.submit()">
                            <option th:each="y : ${#numbers.sequence(2023, #dates.year(#dates.createNow()))}"
                                    th:value="${y}" th:text="${y}" th:selected="${y == selectedYear}"></option>
                        </select>
                    </div>
                    <div class="col-md-4" th:if="${selectedPeriod == 'month'}">
                        <select name="month" class="form-select" onchange="this.form.submit()">
                            <option value="1" th:selected="${selectedMonth == 1}">January</option>
                            <option value="2" th:selected="${selectedMonth == 2}">February</option>
                            <option value="3" th:selected="${selectedMonth == 3}">March</option>
                            <option value="4" th:selected="${selectedMonth == 4}">April</option>
                            <option value="5" th:selected="${selectedMonth == 5}">May</option>
                            <option value="6" th:selected="${selectedMonth == 6}">June</option>
                            <option value="7" th:selected="${selectedMonth == 7}">July</option>
                            <option value="8" th:selected="${selectedMonth == 8}">August</option>
                            <option value="9" th:selected="${selectedMonth == 9}">September</option>
                            <option value="10" th:selected="${selectedMonth == 10}">October</option>
                            <option value="11" th:selected="${selectedMonth == 11}">November</option>
                            <option value="12" th:selected="${selectedMonth == 12}">December</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sales Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h6 class="card-title">Total Sales</h6>
                        <h3 th:text="${salesStats.totalSales}">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h6 class="card-title">Total Revenue</h6>
                        <h3 th:text="${#numbers.formatDecimal(salesStats.totalRevenue, 0, 'COMMA', 0, 'POINT') + ' TZS'}">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h6 class="card-title">Average Order Value</h6>
                        <h3 th:text="${#numbers.formatDecimal(salesStats.averageOrderValue, 0, 'COMMA', 0, 'POINT') + ' TZS'}">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <h6 class="card-title">Total Items Sold</h6>
                        <h3 th:text="${salesStats.totalItems}">0</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Top Selling Products -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Top Selling Products</h5>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity Sold</th>
                                    <th>Revenue</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="product : ${topProducts}">
                                    <td th:text="${product.name}"></td>
                                    <td th:text="${product.quantity}"></td>
                                    <td th:text="${#numbers.formatDecimal(product.revenue, 0, 'COMMA', 0, 'POINT') + ' TZS'}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Low Stock Alert -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Low Stock Alert</h5>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Current Stock</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="product : ${lowStockProducts}">
                                    <td th:text="${product.name}"></td>
                                    <td th:text="${product.stock}"></td>
                                    <td>
                                        <span th:if="${product.stock == 0}" class="badge bg-danger">Out of Stock</span>
                                        <span th:if="${product.stock <= 5 && product.stock > 0}" class="badge bg-warning">Low Stock</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Chart -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Monthly Sales Trend</h5>
            </div>
            <div class="card-body">
                <canvas id="salesChart"></canvas>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // Sales Chart
        const monthlyData = /*[[${monthlySales}]]*/ [];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        new Chart(document.getElementById('salesChart'), {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Revenue (TZS)',
                    data: monthlyData.map(data => data.revenue),
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }, {
                    label: 'Number of Sales',
                    data: monthlyData.map(data => data.sales),
                    borderColor: 'rgb(255, 99, 132)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html> 